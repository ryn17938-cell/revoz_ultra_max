<%- include('../partials/header') %>

<div class="container admin-container">
    <div class="admin-layout">
        <div class="admin-sidebar">
            <h3>Menu</h3>
            <ul>
                <li><a href="/admin/dashboard">Dashboard</a></li>
                <li class="active"><a href="/admin/products">Products</a></li>
                <li><a href="/admin/orders">Orders</a></li>
                <li><a href="/admin/users">Users</a></li>
            </ul>
        </div>

        <div class="admin-main-content">
            <h1>Product Management</h1>

            <!-- Product Management Section -->
            <div class="card">
                <h3 id="form-title">Add New Product</h3>
                <form id="product-form" action="/admin/products/add" method="POST" enctype="multipart/form-data">
                    <input type="hidden" id="id" name="id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">Product Name</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="price">Price</label>
                            <input type="number" id="price" name="price" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="stock">Stock</label>
                            <input type="number" id="stock" name="stock" required>
                        </div>
                        <div class="form-group">
                            <label for="category_id">Category</label>
                            <select id="category_id" name="category_id" required>
                                <% categories.forEach(cat => { %>
                                    <option value="<%= cat.id %>"><%= cat.name %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productImage">Product Image</label>
                            <input type="file" id="productImage" name="productImage">
                        </div>
                        <div class="form-group full-width">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" rows="4"></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Product</button>
                        <button type="button" id="cancel-edit" class="btn btn-secondary" style="display: none;">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h3>Existing Products</h3>
                <div class="table-responsive">
                    <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th>Image</th>
                                                    <th>Name</th>
                                                    <th>Category</th>
                                                    <th>Price</th>
                                                    <th>Stock</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% products.forEach(product => { %>
                                                    <tr>
                                                        <td>
                                                            <img src="/<%= product.image_url || 'img/placeholder.png' %>" alt="<%= product.name %>" width="60" height="60" style="object-fit: cover; border-radius: 4px;">
                                                        </td>
                                                        <td><%= product.name %></td>
                                                        <td><%= product.category_name %></td>
                                                        <td>$<%= product.price %></td>
                                                        <td><%= product.stock %></td>
                                                        <td class="table-actions">
                                                            <button class="btn-edit" 
                                                                data-id="<%= product.id %>" 
                                                                data-name="<%= product.name %>"
                                                                data-price="<%= product.price %>"
                                                                data-stock="<%= product.stock %>"
                                                                data-category="<%= product.category_id %>"
                                                                data-description="<%= product.description || '' %>"
                                                            >Edit</button>
                                                            <form action="/admin/products/delete/<%= product.id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                                                                <button type="submit" class="btn-delete">Delete</button>
                                                            </form>
                                                        </td>
                                                    </tr>
                                                <% }); %>
                                            </tbody>
                                        </table>                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const productForm = document.getElementById('product-form');
        const formTitle = document.getElementById('form-title');
        const cancelBtn = document.getElementById('cancel-edit');
        const hiddenIdInput = document.getElementById('id');
        
        document.querySelectorAll('.btn-edit').forEach(button => {
            button.addEventListener('click', (e) => {
                const btn = e.target;
                const productData = btn.dataset;

                // Populate form
                formTitle.innerText = 'Edit Product';
                productForm.action = '/admin/products/edit';
                hiddenIdInput.value = productData.id;
                document.getElementById('name').value = productData.name;
                document.getElementById('price').value = productData.price;
                document.getElementById('stock').value = productData.stock;
                document.getElementById('category_id').value = productData.category;
                document.getElementById('description').value = productData.description;
                
                cancelBtn.style.display = 'inline-block';
                window.scrollTo(0, 0); // Scroll to top to see form
            });
        });

        cancelBtn.addEventListener('click', () => {
            formTitle.innerText = 'Add New Product';
            productForm.action = '/admin/products/add';
            productForm.reset();
            hiddenIdInput.value = '';
            cancelBtn.style.display = 'none';
        });
    });
</script>

<%- include('../partials/footer') %>
